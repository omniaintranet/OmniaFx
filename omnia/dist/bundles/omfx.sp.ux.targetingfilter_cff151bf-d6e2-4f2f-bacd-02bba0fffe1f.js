if("undefined"==typeof omniaLoader&&(globalThis.omniaLoader={}),omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]=omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]||{},omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["cff151bf-d6e2-4f2f-bacd-02bba0fffe1f"])throw new Error("Error, already loaded manifest cff151bf-d6e2-4f2f-bacd-02bba0fffe1f with service id bb000000-0000-bbbb-0000-0000000000bb");omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["cff151bf-d6e2-4f2f-bacd-02bba0fffe1f"]=function(){(()=>{var e={"./client/fx/sp/ux/targetingfilter/targetingfilter.tsx":(e,t,r)=>{"use strict";r.r(t),r.d(t,{TargetingFilter:()=>y});var i,s=r("./node_modules/@vue/composition-api/dist/vue-composition-api.mjs"),a=r("./node_modules/vue-class-component/dist/vue-class-component.esm.js"),o=r("./node_modules/vue-property-decorator/lib/vue-property-decorator.js"),n=r("14a8d443-2e58-450b-a462-258bdaf69b49").setCurrentManifest("bb000000-0000-bbbb-0000-0000000000bb","cff151bf-d6e2-4f2f-bacd-02bba0fffe1f");(i||(i={})).namespace="Omnia.TargetingFilter";var l=r("d7327742-5647-4075-b7ab-4f9ca852addb").setCurrentManifest("bb000000-0000-bbbb-0000-0000000000bb","cff151bf-d6e2-4f2f-bacd-02bba0fffe1f"),d=r("d0a145a7-d1ef-4217-aa6f-85dd18c4231d"),p=r("5e618f4d-d014-414e-a681-89e34cbeda0f"),b=r("bf86b3f8-7274-47e4-9e27-87ae1cf65a23"),g=r("./node_modules/csx/lib.es2015/index.js");l.StyleFlow.define(b.TargetingFilterStyles,{transparent:{backgroundColor:(0,g.important)("transparent")},link:{cursor:"pointer"},dropdown:{marginTop:(0,g.important)("15px")}});var c=r("./node_modules/typestyle/umd/typestyle.js"),h=r("e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac"),f=Object.defineProperty,m=Object.getOwnPropertyDescriptor,u=(e,t,r,i)=>{for(var s,a=i>1?void 0:i?m(t,r):t,o=e.length-1;o>=0;o--)(s=e[o])&&(a=(i?s(t,r,a):s(a))||a);return i&&a&&f(t,r,a),a};let y=class extends l.VueComponentBase{constructor(){super(...arguments),this.targetingClasses=l.StyleFlow.use(b.TargetingFilterStyles),this.isLoadingProperties=!0,this.targetingEnterprisePropertiesHash={},this.targetingEnterprisePropertiesSelections=[],this.selectedTargetingFilter=[],this.targetingPropertiesGroupingHash={}}filterChange(e,t){e!==t&&this.init()}created(){this.init()}mounted(){n.WebComponentBootstrapper.registerElementInstance(this,this.$el)}init(){this.localizationService.allLanguages.then((e=>{this.selectedTargetingFilter.forEach((t=>{t.languages&&t.languages.length>0&&(this.language=e.find((e=>e.name===t.languages[0])))}))})),this.initIfNull(),n.Utils.isNullOrEmpty(this.filter)||(this.selectedTargetingFilter=Object.keys(this.filter.enterprisePropertiesSettings).map((e=>({propertyName:e,...this.filter.enterprisePropertiesSettings[e]})))),Promise.all([this.enterprisePropertyStore.actions.ensureLoadData.dispatch().then((()=>{this.isLoadingProperties=!1})),this.targetingPropertyStore.actions.ensureLoadData.dispatch()]).then((()=>{this.enterprisePropertyStore.getters.enterprisePropertyDefinitions().filter((e=>e.enterprisePropertyDataType.indexedType==d.PropertyIndexedType.Taxonomy||e.enterprisePropertyDataType.indexedType==d.PropertyIndexedType.Language)).forEach((e=>{const t=this.targetingPropertyStore.getters.propertiesForEnterpriseProperty(e.id);t&&t.length>0&&(this.$set(this.targetingEnterprisePropertiesHash,e.internalName,e),this.targetingEnterprisePropertiesSelections.push(e),e.enterprisePropertyDataType.indexedType==d.PropertyIndexedType.Taxonomy&&this.$set(this.targetingPropertiesGroupingHash,e.internalName,t))}))}))}beforeDestroy(){}addTargetingFilter(){this.selectedTargetingFilter.push({termIds:[],includeChildTerms:!1,propertyName:"",languages:[],targetingPropertyIds:null}),this.$forceUpdate()}removeTargetingFilter(e){this.selectedTargetingFilter=this.selectedTargetingFilter.filter((t=>t.propertyName!=e.propertyName)),delete this.filter.enterprisePropertiesSettings[e.propertyName],(0,l.isEmpty)(this.filter.enterprisePropertiesSettings)&&(this.filter=null),this.onFilterChanged&&this.onFilterChanged(this.filter),this.$forceUpdate()}onPropertyChange(e,t){e.propertyName=t,this.filter=null,this.initIfNull(),this.selectedTargetingFilter.forEach((e=>{this.mapToTargetingFilter(e)})),this.$forceUpdate()}onTermPickerChange(e,t){e.termIds=t,this.updateFilterValue(e),this.$forceUpdate()}onCheckboxChange(e){e.includeChildTerms=!e.includeChildTerms,this.updateFilterValue(e)}onTargetPropertyCheckboxChange(e,t,r){if(null==e.targetingPropertyIds&&this.targetingPropertiesGroupingHash[e.propertyName]&&(e.targetingPropertyIds=[],this.targetingPropertiesGroupingHash[e.propertyName].forEach((t=>{e.targetingPropertyIds.push(t.id)}))),r){e.targetingPropertyIds.indexOf(t)<0&&e.targetingPropertyIds.push(t)}else e.targetingPropertyIds=e.targetingPropertyIds.filter((e=>e!=t));this.updateFilterValue(e)}updateFilterValue(e){const t=e.propertyName;this.filter.enterprisePropertiesSettings[t]={includeChildTerms:e.includeChildTerms,termIds:e.termIds,languages:e.languages,targetingPropertyIds:e.targetingPropertyIds},this.onFilterChanged&&this.onFilterChanged(this.filter)}initIfNull(){(n.Utils.isNullOrEmpty(this.filter)||n.Utils.isNullOrEmpty(this.filter.enterprisePropertiesSettings))&&(this.filter={enterprisePropertiesSettings:{}})}mapToTargetingFilter(e){this.filter.enterprisePropertiesSettings[e.propertyName]={includeChildTerms:e.includeChildTerms,termIds:e.termIds,languages:e.languages,targetingPropertyIds:e.targetingPropertyIds}}getSelectionTargetingProperties(e,t){const r={};return this.targetingPropertiesGroupingHash[t]&&this.targetingPropertiesGroupingHash[t].forEach((t=>{r[t.id.toString()]=null==e.targetingPropertyIds||e.targetingPropertyIds.indexOf(t.id)>-1})),r}get finishLoading(){return!this.isLoadingProperties}get noTargeting(){return!this.isLoadingProperties&&n.Utils.isArrayNullOrEmpty(this.targetingEnterprisePropertiesSelections)}render(){return(0,s.h)("v-card",{attrs:{flat:!0,tile:!0},class:this.targetingClasses.transparent},[this.finishLoading?this.noTargeting?(0,s.h)("div",[this.loc.EmptyTargeting]):(0,s.h)("v-row",{attrs:{"no-gutters":!0},class:"d-flex wrap ma-0"},[this.label&&this.renderLabel(),this.selectedTargetingFilter&&this.renderFilter(),!this.disabled&&(0,s.h)("v-col",{attrs:{cols:"12"}},[(0,s.h)("a",{class:(0,c.classes)(this.targetingClasses.link,this.theming.body.text.css),on:{click:this.addTargetingFilter}},[this.loc.AddTargeting])])]):(0,s.h)("div",{class:"text-center"},[" ",(0,s.h)("v-progress-circular",{attrs:{indeterminate:!0}})])])}renderFilter(){const e=[];return this.selectedTargetingFilter.forEach(((t,r)=>{e.push((0,s.h)("v-col",{attrs:{cols:"12"}},[(0,s.h)("v-row",{attrs:{"no-gutters":!0},class:"d-flex ma-0"},[!this.disabled&&(0,s.h)("div",[(0,s.h)("omfx-button",{attrs:{dark:this.theming.body.bg.dark,contentClass:"mt-7 mr-2"},domProps:{onClick:()=>{this.removeTargetingFilter(t)},icon:{iconType:new d.FontAwesomeIcon("close")},mode:d.ButtonModes.flat}})]),(0,s.h)("v-col",[(0,s.h)("v-row",{attrs:{"no-gutters":!0},class:"d-flex wrap ma-0"},[(0,s.h)("v-col",{attrs:{cols:this.fullWidth?"12":"6"}},[(0,s.h)("v-select",{attrs:{filled:!0,dark:this.theming.body.bg.dark,disabled:this.disabled,"item-value":"internalName","item-text":"multilingualTitle",label:this.loc.SelectProperty,items:this.targetingEnterprisePropertiesSelections},on:{change:e=>{this.onPropertyChange(t,e)}},class:this.targetingClasses.dropdown,model:{value:t.propertyName,callback:e=>{this.$set(t,"propertyName",e)}}})]),this.renderProperty(t,r)])])]),(0,s.h)("v-divider",{directives:[{name:"show",value:r<this.selectedTargetingFilter.length-1}]})]))})),e}renderProperty(e,t){const r=this.targetingEnterprisePropertiesHash[e.propertyName];if(r){if(r.enterprisePropertyDataType.indexedType==d.PropertyIndexedType.Taxonomy)return this.renderTaxonomyProperty(e,r,t);if(r.enterprisePropertyDataType.indexedType==d.PropertyIndexedType.Language)return this.renderLanguageProperty(e,r)}return[]}renderTaxonomyProperty(e,t,r){const i=t.settings,a=this.getSelectionTargetingProperties(e,t.internalName);return[(0,s.h)("v-col",{attrs:{cols:this.fullWidth?"12":"6"}},[(0,s.h)("v-card",{attrs:{flat:!0,tile:!0},class:this.targetingClasses.transparent},[(0,s.h)("v-row",{attrs:{"no-gutters":!0},class:"d-flex ma-0"},[(0,s.h)("v-col",{class:"flex-grow-0 flex-shrink-1 px-3 pt-8",directives:[{name:"show",value:!this.fullWidth}]},[(0,s.h)("span",["="])]),(0,s.h)("v-col",[(0,s.h)("div",{class:this.targetingClasses.dropdown},[(0,s.h)("omfx-term-picker",{key:"TermPicker_"+t.internalName,domProps:{termSetId:i.termSetId,preSelectedTermIds:e.termIds,lcid:this.lcid,onTermsSelected:t=>{this.onTermPickerChange(e,t)}},attrs:{disabled:this.disabled,label:t.multilingualTitle,multi:!!n.Utils.isNull(this.multi)||this.multi,includeDeprecated:!0}})])])])])]),this.targetingPropertiesGroupingHash[t.internalName]&&this.targetingPropertiesGroupingHash[t.internalName].length>1&&(0,s.h)("v-col",{attrs:{cols:"12"},class:"mb-3"},[this.targetingPropertiesGroupingHash[t.internalName].map((t=>(0,s.h)("v-checkbox",{attrs:{disabled:this.disabled,dark:this.theming.body.bg.dark,label:t.data.title,"input-value":a[t.id.toString()]},class:"mt-0",on:{change:r=>{this.onTargetPropertyCheckboxChange(e,t.id,r)}},model:{value:a[t.id.toString()],callback:e=>{this.$set(a,t.id.toString(),e)}}})))]),(0,s.h)("v-col",{attrs:{cols:"12"}},[(0,s.h)("v-checkbox",{attrs:{disabled:this.disabled,dark:this.theming.body.bg.dark,label:this.loc.IncludeChildrens,"input-value":e.includeChildTerms},class:"mt-0",on:{change:t=>{this.onCheckboxChange(e)}},model:{value:e.includeChildTerms,callback:t=>{this.$set(e,"includeChildTerms",t)}}})])]}onLanguageChanged(e,t){this.language=t,e.languages=[t.name],this.updateFilterValue(e)}renderLanguageProperty(e,t){return[(0,s.h)("v-col",{attrs:{cols:this.fullWidth?"12":"6"}},[(0,s.h)("v-card",{attrs:{flat:!0,tile:!0},class:this.targetingClasses.transparent},[(0,s.h)("v-row",{attrs:{"no-gutters":!0},class:"d-flex ma-0"},[(0,s.h)("v-col",{class:"flex-grow-0 flex-shrink-1 px-3 pt-8",directives:[{name:"show",value:!this.fullWidth}]},[(0,s.h)("span",["="])]),(0,s.h)("v-col",[(0,s.h)("omfx-language-picker",{attrs:{enableContextSettings:!0,disabled:this.disabled},key:"LanguagePropPicker_"+t.internalName,domProps:{valueBind:this.language,onValueChanged:t=>{this.onLanguageChanged(e,t)}}})])])])])]}renderLabel(){return(0,s.h)("v-col",{attrs:{cols:"12"}},[(0,s.h)("v-card",{attrs:{dark:this.theming.body.bg.dark,flat:!0,tile:!0},class:(0,c.classes)(this.targetingClasses.transparent,"mb-2",this.theming.body.text.css)},[this.label])])}};u([(0,n.Localize)(i.namespace)],y.prototype,"loc",2),u([(0,n.Inject)(p.EnterprisePropertyStore)],y.prototype,"enterprisePropertyStore",2),u([(0,n.Inject)(p.TargetingPropertyStore)],y.prototype,"targetingPropertyStore",2),u([(0,n.Inject)(n.OmniaContext)],y.prototype,"omniaContext",2),u([(0,n.Inject)(h.LocalizationService)],y.prototype,"localizationService",2),u([(0,o.Prop)({default:null})],y.prototype,"filter",2),u([(0,o.Prop)()],y.prototype,"onFilterChanged",2),u([(0,o.Prop)()],y.prototype,"disabled",2),u([(0,o.Prop)()],y.prototype,"fullWidth",2),u([(0,o.Prop)()],y.prototype,"lcid",2),u([(0,o.Prop)()],y.prototype,"label",2),u([(0,o.Prop)({default:void 0})],y.prototype,"multi",2),u([(0,o.Watch)("filter",{deep:!0})],y.prototype,"filterChange",1),y=u([a.default],y),n.WebComponentBootstrapper.registerElement((e=>{(0,n.vueCustomElement)(e.elementName,y)}))},"./node_modules/@vue/composition-api/dist/vue-composition-api.mjs":(e,t,r)=>{e.exports=r("dll-reference md2")("./node_modules/@vue/composition-api/dist/vue-composition-api.mjs")},"./node_modules/csx/lib.es2015/index.js":(e,t,r)=>{e.exports=r("dll-reference md2")("./node_modules/csx/lib.es2015/index.js")},"./node_modules/typestyle/umd/typestyle.js":(e,t,r)=>{e.exports=r("dll-reference md2")("./node_modules/typestyle/umd/typestyle.js")},"./node_modules/vue-class-component/dist/vue-class-component.esm.js":(e,t,r)=>{e.exports=r("dll-reference md2")("./node_modules/vue-class-component/dist/vue-class-component.esm.js")},"./node_modules/vue-property-decorator/lib/vue-property-decorator.js":(e,t,r)=>{e.exports=r("dll-reference md2")("./node_modules/vue-property-decorator/lib/vue-property-decorator.js")},"14a8d443-2e58-450b-a462-258bdaf69b49":(e,t,r)=>{e.exports=r("dll-reference md10")("14a8d443-2e58-450b-a462-258bdaf69b49")},"5e618f4d-d014-414e-a681-89e34cbeda0f":(e,t,r)=>{e.exports=r("dll-reference md10")("5e618f4d-d014-414e-a681-89e34cbeda0f")},"bf86b3f8-7274-47e4-9e27-87ae1cf65a23":(e,t,r)=>{e.exports=r("dll-reference md19")("bf86b3f8-7274-47e4-9e27-87ae1cf65a23")},"d0a145a7-d1ef-4217-aa6f-85dd18c4231d":(e,t,r)=>{e.exports=r("dll-reference md9")("d0a145a7-d1ef-4217-aa6f-85dd18c4231d")},"d7327742-5647-4075-b7ab-4f9ca852addb":(e,t,r)=>{e.exports=r("dll-reference md66")("d7327742-5647-4075-b7ab-4f9ca852addb")},"e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac":(e,t,r)=>{e.exports=r("dll-reference md10")("e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac")},"dll-reference md2":e=>{"use strict";e.exports=omniaVendor},"dll-reference md19":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["93b0c582-b7e3-4b47-9b22-4412bd7df9e5"]},"dll-reference md9":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["a2892051-fd9f-4056-ae8d-30d16d48417d"]},"dll-reference md10":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["a5a89056-b5f5-475d-8518-a1f55090379d"]},"dll-reference md66":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["dee030cc-4ab3-4158-bb06-8049f5c67542"]}};if("undefined"==typeof omniaWebpackJsonp&&(globalThis.omniaWebpackJsonp={}),globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]=globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]||{},globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["cff151bf-d6e2-4f2f-bacd-02bba0fffe1f"])throw new Error("Error, already loaded manifest cff151bf-d6e2-4f2f-bacd-02bba0fffe1f with service id bb000000-0000-bbbb-0000-0000000000bb");globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["cff151bf-d6e2-4f2f-bacd-02bba0fffe1f"]=r;var t={};function r(i){var s=t[i];if(void 0!==s)return s.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,r),a.exports}r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};r("./client/fx/sp/ux/targetingfilter/targetingfilter.tsx")})()};