if("undefined"==typeof omniaLoader&&(globalThis.omniaLoader={}),omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]=omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]||{},omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["fd300449-c17f-44fd-80d8-3e709a10bf63"])throw new Error("Error, already loaded manifest fd300449-c17f-44fd-80d8-3e709a10bf63 with service id bb000000-0000-bbbb-0000-0000000000bb");omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["fd300449-c17f-44fd-80d8-3e709a10bf63"]=function(){(()=>{var e={"./client/fx/ux/features/featuresjourney.tsx":(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var a=s("./node_modules/@vue/composition-api/dist/vue-composition-api.mjs"),r=s("./node_modules/vue/dist/vue.esm.js"),i=s("./node_modules/vue-property-decorator/lib/vue-property-decorator.js"),o=s("d7327742-5647-4075-b7ab-4f9ca852addb").setCurrentManifest("bb000000-0000-bbbb-0000-0000000000bb","fd300449-c17f-44fd-80d8-3e709a10bf63"),n=s("14a8d443-2e58-450b-a462-258bdaf69b49").setCurrentManifest("bb000000-0000-bbbb-0000-0000000000bb","fd300449-c17f-44fd-80d8-3e709a10bf63"),d=s("./node_modules/typestyle/umd/typestyle.js"),c=s("./node_modules/vue-class-component/dist/vue-class-component.esm.js"),l=s("5e618f4d-d014-414e-a681-89e34cbeda0f"),u=s("d0a145a7-d1ef-4217-aa6f-85dd18c4231d"),h=s("5326a8ef-4e3c-49d6-b415-1ddf7fdcc830"),p=s("14a0ce2f-3699-49b2-92d3-428caac194a4"),m=s("0111486e-5dc8-4705-8247-d91fb2aba33d"),g=s("e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac"),b=Object.defineProperty,f=Object.getOwnPropertyDescriptor,v=(e,t,s,a)=>{for(var r,i=a>1?void 0:a?f(t,s):t,o=e.length-1;o>=0;o--)(r=e[o])&&(i=(a?r(t,s,i):r(i))||i);return a&&i&&b(t,s,i),i};let y=class extends o.VueComponentBase{constructor(){super(...arguments),this.key=n.Utils.generateGuid(),this.isLoadingPermissions=!0,this.isLoadingFeatures=!0,this.isUpgradingFull=!1,this.featuresInstances=[],this.featuresRequireUpgrade=[],this.headers=[{text:this.omniaUxLoc.Common.Title,align:"left",sortable:!1}],this.consentDialogHeaders=[{text:this.omniaUxLoc.Common.Title,value:"title",align:"left",sortable:!1,width:"70%"},{text:this.loc.Approved,value:"approved",align:"left",sortable:!1,width:"15%"},{text:this.loc.Type,value:"type",align:"left",sortable:!1,width:"15%"}],this.requiredConsentFeatures={},this.consentDialogVisible=!1,this.consentUrlDialogVisible=!1,this.resources=[],this.consentUrl="",this.colors={active:"#27ae61",deactive:"#979797",busy:"#ff8a00",needUpgrade:"#ff8a00",error:"#db2001"}}created(){n.Utils.isNullOrEmpty(this.targetResolverType)&&(this.targetResolverType=u.TargetResolverTypes.BusinessProfile),this.currentBladeId=m.AdminRouter.routeContext.path.value,this.loadData(),this.subscriptionHandler.add(this.featureStore.editingFeatureInstance.onMutated((()=>{this.editingFeatureInstance()})))}beforeDestroy(){this.allowCheckingStatus=!1}get isLoading(){return this.isLoadingFeatures||this.isLoadingPermissions}loadData(){this.allowCheckingStatus=!0,this.isLoadingFeatures=!0,this.isLoadingPermissions=!0;const e=this.getParams();this.securityService.getConsentUrl(this.getRedirectUrl()).then((e=>this.consentUrl=e)),this.securityService.getTenantRequiredAzureAdPermissions().then((e=>{this.resources=e,this.isLoadingPermissions=!1})).then((()=>this.featureStore.actions.loadFeatureDefinitions.dispatch())).then((()=>{this.featureStore.actions.loadFeatureInstances.dispatch(this.targetResolverType,e).then((()=>{this.isLoadingFeatures=!1,this.bindFeaturesInstances(),this.pollingFeatureStatusIfNeeded(),this.subscriptionHandler.add(this.featureStore.featureInstances.onMutated((()=>{this.bindFeaturesInstances()})))})).catch((e=>{this.isLoadingFeatures=!1}))}))}pollingFeatureStatusIfNeeded(){this.featuresInstances.forEach((e=>{this.isPollingNeeded(e.item.status)&&this.handleFeatureStatus(e.item)}))}isPollingNeeded(e){return e==u.FeatureInstanceStatus.Activating||e==u.FeatureInstanceStatus.Deactivating||e==u.FeatureInstanceStatus.Upgrading||e==u.FeatureInstanceStatus.AdminConsentActivating||e==u.FeatureInstanceStatus.AdminConsentUpgrading}editingFeatureInstance(){const e=this.featureStore.editingFeatureInstance.state,t=this.featuresInstances.find((t=>t.item.featureId==e.featureId));switch(this.featureStore.editingFeatureInstanceAction.state){case o.FeatureActions.active:this.activateFeature(t,e.properties.properties,!0);break;case o.FeatureActions.upgrade:this.upgradeFeature(t,e.properties.properties,!0);break;case o.FeatureActions.remove:this.removeFeature(t)}}getParams(){const e={};return this.targetResolverType==u.TargetResolverTypes.AppInstance?this.appInstanceId&&(e[u.Parameters.AppInstanceId]=this.appInstanceId):this.targetResolverType==u.TargetResolverTypes.BusinessProfile&&this.omniaContext.businessProfile&&(e[u.Parameters.BusinessProfileId]=this.omniaContext.businessProfile.id),e}onClose(){this.handleClose()}onFeatureAction(e,t){this.handleFeatureAction(e,t)}bindFeaturesInstances(){const e=[];if(this.featuresInstances=[],this.featureStore.featureInstances.state){this.featureStore.featureInstances.state.forEach((t=>{const s=this.featureStore.getters.getFeatureDefinition(t.featureId);if(!s.hidden){let a=!1;0!==s.requiresAzureAdAppPermissions.length&&s.requiresAzureAdAppPermissions.forEach((e=>{const t=this.resources.find((t=>t.id===e.resourceAppId.toString()));t||(a=!0),t.resourceAccess.length>0&&e.resourceAccess.forEach((e=>{const s=t.resourceAccess.find((t=>t.id===e.id));s&&s.approved||(a=!0)}))})),e.push({isGroupHeader:!1,selected:!1,item:t,title:s?s.title:"",category:s?s.category:"",description:s?s.description:"",needConsent:a,isBusy:!1})}}));n.Utils.groupBy(e,"category").forEach((e=>{this.featuresInstances.push({isGroupHeader:!0,category:e.key,selected:!1,item:{}}),this.featuresInstances=this.featuresInstances.concat(e.items)})),e.filter((e=>e.item.isActivated)).forEach((e=>{const t=this.featureStore.getters.getFeatureDefinition(e.item.featureId);t&&t.version!==e.item.version&&e.item.status==u.FeatureInstanceStatus.Activated&&this.featuresRequireUpgrade.push(e)}))}}handlePropertyBlade(e,t){const s=this.featureStore.getters.getFeatureDefinition(e.item.featureId);return!(!s||n.Utils.isNullOrEmpty(s.uiOptions)||n.Utils.isNullOrEmpty(s.uiOptions.customRendererElement))&&(e.selected=!1,this.onFeatureAction(t,e.item.featureId),!0)}handleFeatureStatus(e){if(!this.allowCheckingStatus)return;const t=this.featuresInstances.find((t=>t.item.featureId==e.featureId));t.item=e,e.status==u.FeatureInstanceStatus.Activating||e.status==u.FeatureInstanceStatus.Deactivating||e.status==u.FeatureInstanceStatus.Upgrading||e.status==u.FeatureInstanceStatus.AdminConsentActivating||e.status==u.FeatureInstanceStatus.AdminConsentUpgrading?this.featureStore.actions.loadFeatureInstance.dispatch(e.featureId).then((e=>{setTimeout((()=>this.handleFeatureStatus(e)),1e3)})).catch((()=>{})):(t.selected=!1,e.status,u.FeatureInstanceStatus.Error)}activateFeature(e,t,s){e.selected=!0,e.isBusy=!0,1!=s&&this.handlePropertyBlade(e,o.FeatureActions.active)||this.featureStore.actions.activateFeature.dispatch(e.item.featureId,t).then((t=>{this.handleFeatureStatus(t),e.isBusy=!1})).catch((e=>{}))}removeFeature(e){e.selected=!0,e.isBusy=!0,this.featureStore.actions.removeFeature.dispatch(e.item.featureId).then((t=>{this.handleFeatureStatus(t),e.isBusy=!1})).catch((e=>{}))}upgradeFeature(e,t,s){e.selected=!0,e.isBusy=!0,1!=s&&this.handlePropertyBlade(e,o.FeatureActions.upgrade)||this.featureStore.actions.upgradeFeature.dispatch(e.item.featureId,t).then((t=>{this.handleFeatureStatus(t),e.isBusy=!1})).catch((e=>{}))}doOneFeatureUpgradeAsPromise(e,t){return e.isBusy=!0,this.featureStore.actions.upgradeFeature.dispatch(e.item.featureId,t).then((t=>{this.handleFeatureStatus(t),e.isBusy=!1})).catch((e=>{}))}upgradeAllFeatures(){const e=[...this.featuresRequireUpgrade];0!==e.length&&(this.isUpgradingFull=!0,Promise.all(e.map((e=>this.doOneFeatureUpgradeAsPromise(e,e.item.properties)))).then((e=>{this.isUpgradingFull=!1,this.featuresRequireUpgrade=[]})))}populateAzureAdPermissionsInfo(e){this.requiredConsentFeatures[e.featureId.toString()]||(this.azureAdPermissionResourcesPromise||(this.azureAdPermissionResourcesPromise=this.securityService.getTenantRequiredAzureAdPermissions()),this.azureAdPermissionResourcesPromise.then((t=>{const s=this.featureStore.getters.getFeatureDefinition(e.featureId),a=[];s.requiresAzureAdAppPermissions.forEach((e=>{const s=t.find((t=>t.id===e.resourceAppId.toString()));e.resourceAccess.forEach((t=>{let r=s.resourceAccess.find((e=>e.id===t.id.toString()));r||(r={id:t.id.toString(),type:t.type,displayName:t.name,requireExtensionIds:[],requireFeatureIds:[],approved:!1}),a.push({id:r.id,name:r.displayName,type:"Role"===r.type?"App":"Scope"===r.type?"Delegated":"Unknown",approved:r.approved,appId:e.resourceAppId.toString()})}))})),this.requiredConsentFeatures=Object.assign({},this.requiredConsentFeatures,{[e.featureId.toString()]:a})})))}getConsentUrl(){if(!this.currentBladeId)return"";if(""!==this.consentUrl)return this.consentUrl;const e=n.ServiceLocator.getUrl(u.OmniaService.Id),t=this.getRedirectUrl();return`${e}/api/auth/adminconsent/redirect?redirectUrl=${encodeURIComponent(t)}`}getRedirectUrl(){const e=n.ServiceLocator.getUrl(u.OmniaService.Id),t=`${e}${p.Router.routeContext.path.value}/@admin/${this.currentBladeId}`;return`${e}/api/features/adminconsent?redirectUrl=${encodeURIComponent(t)}`}adminConsentRedirect(){const e=this.getConsentUrl();""!==e&&(window.open(e),this.closeConsentDialog())}copyUrlToClipboard(){navigator.clipboard.writeText(this.getConsentUrl())}showConsentDialog(e){this.currentConsentFeatureId=e.featureId.toString(),this.consentDialogVisible=!0,this.populateAzureAdPermissionsInfo(e)}closeConsentDialog(){this.currentConsentFeatureId=null,this.consentDialogVisible=!1}renderItems(e){if(e.isGroupHeader)return(0,a.h)("tr",[(0,a.h)("td",{attrs:{colspan:this.headers.length},class:(0,d.classes)("text-left",o.FeaturesJourneyStyles.groupTitle)},[(0,a.h)("strong",[e.category])])]);{let t=!1,s="",r=this.colors.active;switch(e.item.status){case u.FeatureInstanceStatus.Activated:const a=this.featureStore.featureDefinitions.state.find((t=>t.id.toString().toLowerCase()==e.item.featureId.toString().toLowerCase()));a&&a.version!==e.item.version&&(r=this.colors.needUpgrade,t=!0,s=a.version);break;case u.FeatureInstanceStatus.Error:r=this.colors.error;break;case u.FeatureInstanceStatus.Activating:case u.FeatureInstanceStatus.Upgrading:case u.FeatureInstanceStatus.Deactivating:case u.FeatureInstanceStatus.AdminConsentActivating:case u.FeatureInstanceStatus.AdminConsentUpgrading:r=this.colors.busy;break;default:r=this.colors.deactive}return(0,a.h)("tr",[(0,a.h)("td",{attrs:{colspan:this.headers.length},class:"pr-0 pl-0"},[(0,a.h)("v-expansion-panel",[(0,a.h)("v-expansion-panel-header",[(0,a.h)("div",{class:"d-flex d-flex-column justify-space-between"},[(0,a.h)("div",{class:"d-flex d-flex-column"},[(0,a.h)("div",{class:"pr-2"},[(0,a.h)("v-avatar",{attrs:{color:r,size:32}})]),(0,a.h)("div",{class:"align-self-center"},[(0,a.h)("div",[(0,a.h)("omfx-limited-label",{attrs:{text:e.title,activateOnLength:55,maxWidth:"365px"}})]),(0,a.h)("div",[e.item.version?(0,a.h)("div",{class:o.FeaturesJourneyStyles.subtitle},["Activated version: ",e.item.version]):(0,a.h)("div",{class:o.FeaturesJourneyStyles.subtitle},["Not activated"])])])]),(0,a.h)("div",{class:"align-self-center"},[this.renderItemAction(e,r,t)])])]),(0,a.h)("v-expansion-panel-content",[(0,a.h)("v-card",{class:"pa-2 mt-2"},[(0,a.h)("v-card-text",{class:"px-4 pt-2 pb-2"},[e.description])]),this.renderItemExpansionInfoAndAction(e,r,t,s),(0,a.h)("div",{class:"float-right mt-2"},[e.item.status==u.FeatureInstanceStatus.Activated||e.item.status==u.FeatureInstanceStatus.Deactivating||e.item.status==u.FeatureInstanceStatus.Upgrading||e.item.status===u.FeatureInstanceStatus.Error?[(0,a.h)("omfx-button",{attrs:{dark:!0,loading:e.isBusy,color:this.omniaTheming.themes.primary.base,contentClass:"ml-0 mr-2 my-1",text:this.loc.Remove},domProps:{onClick:t=>{this.removeFeature(e),t.stopPropagation()}}}),(0,a.h)("omfx-button",{attrs:{dark:!0,loading:e.isBusy,color:this.omniaTheming.themes.primary.base,contentClass:" my-1",text:this.loc.Upgrade},domProps:{onClick:t=>{this.upgradeFeature(e,e.item.properties),t.stopPropagation()}}})]:null])])])])])}}renderItemAction(e,t,s){switch(e.item.status){case u.FeatureInstanceStatus.NotActivated:case u.FeatureInstanceStatus.Activating:return e.needConsent?(0,a.h)("omfx-button",{attrs:{dark:!0,loading:e.isBusy,text:this.loc.RequestConsent},domProps:{onClick:t=>{this.activateFeature(e,e.item.properties),t.stopPropagation()},styles:{bgColor:this.omniaTheming.themes.primary.base}}}):(0,a.h)("omfx-button",{attrs:{dark:!0,loading:e.isBusy,text:this.loc.Activate},domProps:{onClick:t=>{this.activateFeature(e,e.item.properties),t.stopPropagation()},styles:{bgColor:this.omniaTheming.themes.primary.base}}});case u.FeatureInstanceStatus.AdminConsentActivating:case u.FeatureInstanceStatus.AdminConsentUpgrading:case u.FeatureInstanceStatus.Error:return(0,a.h)("v-icon",{attrs:{color:t},class:"pr-2"},["fas fa-info-circle"]);case u.FeatureInstanceStatus.Activated:return s?(0,a.h)("v-icon",{attrs:{color:t},class:"pr-2"},["fas fa-info-circle"]):null}return null}renderItemExpansionInfoAndAction(e,t,s,r){switch(e.item.status){case u.FeatureInstanceStatus.Error:return(0,a.h)("v-card",{class:"pa-4 mt-4"},[(0,a.h)("v-icon",{attrs:{color:t},class:"pr-2"},["fas fa-info-circle"]),this.loc.ErrorMessage,(0,a.h)("kbd",[e.item.transactionId])]);case u.FeatureInstanceStatus.AdminConsentActivating:case u.FeatureInstanceStatus.AdminConsentUpgrading:return[(0,a.h)("v-card",{class:"pa-4 mt-4"},[(0,a.h)("v-icon",{attrs:{color:t},class:"pr-2"},["fas fa-info-circle"]),this.loc.WaitingConsentMessage]),(0,a.h)("div",{class:"float-right mt-2"},[(0,a.h)("omfx-button",{attrs:{dark:!0,color:this.omniaTheming.themes.primary.base,contentClass:"ml-0 mr-2 my-1",loading:e.isBusy,text:this.loc.CancelRequestConsent},domProps:{onClick:t=>{this.removeFeature(e),t.stopPropagation()}}}),(0,a.h)("omfx-button",{attrs:{dark:!0,color:this.omniaTheming.themes.primary.base,contentClass:" my-1",text:this.loc.View},domProps:{onClick:t=>{this.showConsentDialog(e.item),t.stopPropagation()}}})])];case u.FeatureInstanceStatus.Activated:return s?(0,a.h)("v-card",{class:"pa-4 mt-4"},[(0,a.h)("v-icon",{attrs:{color:t},class:"pr-2"},["fas fa-info-circle"]),this.loc.NeedUpgrade,r]):null}return null}renderPermissions(e){const t=!e;return(0,a.h)("v-data-table",{attrs:{headers:this.consentDialogHeaders,items:e,"hide-default-footer":!0,"sort-by":"type","items-per-page":-1,loading:t},scopedSlots:{item:e=>(0,a.h)("tr",[(0,a.h)("td",[e.item.name?e.item.name:e.item.id]),(0,a.h)("td",[(0,a.h)("v-icon",{attrs:{color:this.omniaTheming.themes.primary.base}},[e.item.approved?"fas fa-check":"fas fa-exclamation"])]),(0,a.h)("td",[e.item.type])])}})}render(){return(0,a.h)("div",{key:this.key},[(0,a.h)("v-card",{attrs:{width:"100%",dark:this.omniaTheming.promoted.body.dark}},[(0,a.h)("v-app-bar",{attrs:{flat:!0,dark:this.omniaTheming.promoted.header.dark,color:this.omniaTheming.promoted.header.background.base}},[(0,a.h)("v-toolbar-title",[this.loc.Features]),(0,a.h)("v-spacer"),this.targetResolverType==u.TargetResolverTypes.AppInstance?(0,a.h)("omfx-button",{domProps:{onClick:this.onClose,preset:o.ButtonPresets.icons.close},attrs:{dark:this.omniaTheming.promoted.header.dark}}):null]),(0,a.h)("v-divider"),(0,a.h)("v-card-text",[(0,a.h)("div",{class:"d-flex justify-end align-center"},[!this.isLoading&&this.featuresInstances.find((e=>e.item&&(e.item?.status===u.FeatureInstanceStatus.AdminConsentActivating||e.item?.status===u.FeatureInstanceStatus.AdminConsentUpgrading)))?(0,a.h)("omfx-button",{attrs:{dark:this.theming.body.fg.dark,loading:this.isLoading,text:this.loc.ConsentPermissions},domProps:{styles:{bgColor:this.theming.colors.secondary.base},icon:{iconType:new u.FontAwesomeIcon("fa-info-circle")},onClick:()=>this.consentUrlDialogVisible=!0}}):null,this.isLoading||0===this.featuresRequireUpgrade?.length?null:(0,a.h)("omfx-button",{attrs:{dark:this.theming.body.fg.dark,loading:this.isLoading||this.isUpgradingFull,contentClass:"ml-0 mr-2 my-1",disabled:0===this.featuresRequireUpgrade?.length},domProps:{styles:{bgColor:this.theming.colors.secondary.base},onClick:()=>{this.upgradeAllFeatures()}}},[(0,a.h)("v-avatar",{attrs:{color:this.colors.needUpgrade},domProps:{size:16},class:"mr-2"}),this.loc.UpgradeAll])]),(0,a.h)("v-expansion-panels",{attrs:{accordion:!0}},[this.isLoading?(0,a.h)("div",{class:"text-center"},[(0,a.h)("v-progress-circular",{attrs:{indeterminate:!0}})]):(0,a.h)("v-data-table",{class:o.FeaturesJourneyStyles.tableFullWidth,attrs:{"hide-default-footer":!0,"items-per-page":Number.MAX_SAFE_INTEGER,headers:this.headers,"sort-by":["category","title"],items:this.featuresInstances},scopedSlots:{item:e=>this.renderItems(e.item)}})])])]),this.consentDialogVisible&&this.renderDialog(),this.consentUrlDialogVisible&&this.renderConsentUrlDialog()])}renderDialog(){const e=this.themeStore.getters.getThemingByTargetIdWithFallback(u.Constants.ux.themeTargetIds.layoutDialog),t=this.featuresInstances.find((e=>e.item.featureId&&e.item.featureId.toString()==this.currentConsentFeatureId)),s=this.requiredConsentFeatures[this.currentConsentFeatureId],r=!s;return(0,a.h)("omfx-dialog",{attrs:{valueBind:{visible:!0},width:"600px",title:t.title,position:o.DialogPositions.Center,light:!e.body.bg.dark,dark:e.body.bg.dark,themeTargetId:u.Constants.ux.themeTargetIds.layoutDialog},on:{close:this.closeConsentDialog}},[(0,a.h)("v-card",{attrs:{light:!e.body.bg.dark,color:e.body.bg.color.base,tile:!0,flat:!0}},[(0,a.h)("v-card-text",[this.loc.ConsentMessage,this.renderPermissions(s)]),(0,a.h)("v-card-actions",[(0,a.h)("v-spacer"),(0,a.h)("omfx-button",{attrs:{dark:this.theming.body.fg.dark,loading:r,text:this.loc.AdminConsent},domProps:{styles:{bgColor:this.theming.body.fg.color.base},onClick:this.adminConsentRedirect}}),(0,a.h)("omfx-button",{attrs:{dark:this.theming.body.fg.dark,text:this.omniaUxLoc.Common.Buttons.Close},domProps:{styles:{bgColor:this.theming.colors.secondary.base},onClick:()=>{this.consentDialogVisible=!1}}})])])])}renderConsentUrlDialog(){const e=this.themeStore.getters.getThemingByTargetIdWithFallback(u.Constants.ux.themeTargetIds.layoutDialog);return(0,a.h)("omfx-dialog",{attrs:{valueBind:{visible:!0},width:"600px",title:this.loc.ConsentDialogTitle,position:o.DialogPositions.Center,light:!e.body.bg.dark,dark:e.body.bg.dark,themeTargetId:u.Constants.ux.themeTargetIds.layoutDialog},on:{close:()=>{this.consentUrlDialogVisible=!1}}},[(0,a.h)("v-card",{attrs:{light:!e.body.bg.dark,color:e.body.bg.color.base,tile:!0,flat:!0}},[(0,a.h)("v-card-text",[this.loc.ConsentUrl,(0,a.h)("v-text-field",{attrs:{value:this.getConsentUrl()}})]),(0,a.h)("v-card-actions",[(0,a.h)("v-spacer"),(0,a.h)("omfx-button",{attrs:{dark:this.theming.body.fg.dark,text:this.loc.CopyToClip},domProps:{styles:{bgColor:this.theming.body.fg.color.base},onClick:this.copyUrlToClipboard}}),(0,a.h)("omfx-button",{attrs:{dark:this.theming.body.fg.dark,text:this.loc.AdminConsent},domProps:{styles:{bgColor:this.theming.colors.secondary.base},onClick:this.adminConsentRedirect}}),(0,a.h)("omfx-button",{attrs:{dark:this.theming.body.fg.dark,text:this.omniaUxLoc.Common.Buttons.Close},domProps:{styles:{bgColor:this.theming.colors.secondary.base},onClick:()=>{this.consentUrlDialogVisible=!1}}})])])])}};v([(0,i.Prop)()],y.prototype,"appInstanceId",2),v([(0,i.Prop)()],y.prototype,"handleClose",2),v([(0,i.Prop)()],y.prototype,"handleFeatureAction",2),v([(0,i.Prop)()],y.prototype,"targetResolverType",2),v([(0,n.Localize)(o.OmniaUxLocalizationNamespace)],y.prototype,"omniaUxLoc",2),v([(0,n.Localize)(o.FeaturesLocalization.namespace)],y.prototype,"loc",2),v([(0,n.Inject)(l.FeatureStore)],y.prototype,"featureStore",2),v([(0,n.Inject)(o.ThemeStore)],y.prototype,"themeStore",2),v([(0,n.Inject)(o.OmniaTheming)],y.prototype,"omniaTheming",2),v([(0,n.Inject)(h.OmniaContext)],y.prototype,"omniaContext",2),v([(0,n.Inject)(n.SubscriptionHandler)],y.prototype,"subscriptionHandler",2),v([(0,n.Inject)(g.SecurityService)],y.prototype,"securityService",2),y=v([c.default],y);var I=Object.defineProperty,F=Object.getOwnPropertyDescriptor,C=(e,t,s,a)=>{for(var r,i=a>1?void 0:a?F(t,s):t,o=e.length-1;o>=0;o--)(r=e[o])&&(i=(a?r(t,s,i):r(i))||i);return a&&i&&I(t,s,i),i};let x=class extends o.VueComponentBase{constructor(){super(...arguments),this.formValidator=null,this.featureInstance={},this.isLoading=!1,this.isSavingProp=!1,this.properties={}}created(){this.subscriptionHandler.add(m.AdminRouter.onNavigate.subscribe(this.onNavigate)),this.formValidator=new o.FormValidator(this)}mounted(){n.WebComponentBootstrapper.registerElementInstance(this,this.$el)}getItemIdFromPath(e){if(this.actionParam="",e.endsWith("/"+o.FeatureActions.active)?this.actionParam=o.FeatureActions.active:e.endsWith("/"+o.FeatureActions.upgrade)?this.actionParam=o.FeatureActions.upgrade:e.endsWith("/"+o.FeatureActions.remove)&&(this.actionParam=o.FeatureActions.remove),n.Utils.isNullOrEmpty(this.actionParam))return"";const t=new RegExp("[0-9a-fA-F]{8}[-]?([0-9a-fA-F]{4}[-]?){3}[0-9a-fA-F]{12}/"+this.actionParam+"$");if(t.test(e)){return t.exec(e)[0].split("/")[0]}return""}onNavigate(e){if(e.route){this.featureInstance={};const t=this.getItemIdFromPath(e.route.relativePath);this.featureInstance=this.featureStore.getters.getFeatureInstance(t),this.featureDefinition=this.featureStore.getters.getFeatureDefinition(t),this.featureInstance&&this.featureInstance.properties?this.properties=this.featureInstance.properties.properties:this.properties=null}else this.properties=null}onClose(){this.handleClose()}save(){this.formValidator.validateAll()&&(this.featureInstance.properties={properties:this.properties,contextParams:{}},this.featureStore.mutations.setEditingFeatureInstanceAction(this.actionParam),this.featureStore.mutations.setEditingFeatureInstance(this.featureInstance),this.onClose())}onChanged(e){this.properties=e}renderForm(){if(this.featureDefinition&&this.featureInstance){const e={};return e.onValueChanged=this.onChanged,e.valueBind=this.properties?this.properties:{},e.useValidator=this.formValidator,(0,a.h)(this.featureDefinition.uiOptions.customRendererElement,{key:n.Utils.generateGuid(),domProps:e})}return null}render(){return(0,a.h)("div",[(0,a.h)("v-card",{attrs:{width:"100%",dark:this.omniaTheming.promoted.body.dark}},[(0,a.h)("v-app-bar",{attrs:{flat:!0,dark:this.omniaTheming.promoted.header.dark,color:this.omniaTheming.promoted.header.background.base}},[(0,a.h)("v-toolbar-title",[this.loc.Properties]),(0,a.h)("v-spacer"),(0,a.h)("omfx-button",{attrs:{disabled:this.isSavingProp,dark:this.omniaTheming.promoted.header.dark},domProps:{onClick:()=>this.onClose(),preset:o.ButtonPresets.icons.close}})]),(0,a.h)("v-divider"),(0,a.h)("v-card-text",[this.isLoading?(0,a.h)("div",{class:o.FeaturesJourneyStyles.loadingStyle},[(0,a.h)("v-progress-circular",{attrs:{indeterminate:!0}})]):this.renderForm(),(0,a.h)("v-layout",{attrs:{"align-center":!0,row:!0,wrap:!0}},[(0,a.h)("v-flex",{attrs:{xs12:!0}},[(0,a.h)("omfx-button",{attrs:{loading:this.isSavingProp,text:this.actionParam==o.FeatureActions.active?this.loc.Activate:o.FeatureActions.upgrade?this.loc.Upgrade:this.loc.Remove},domProps:{styles:{bgColor:this.omniaTheming.themes.primary.base},onClick:this.save}})])])])])])}};C([(0,i.Prop)()],x.prototype,"handleClose",2),C([(0,i.Prop)()],x.prototype,"targetResolverType",2),C([(0,n.Localize)(o.FeaturesLocalization.namespace)],x.prototype,"loc",2),C([(0,n.Inject)(o.OmniaTheming)],x.prototype,"omniaTheming",2),C([(0,n.Inject)(l.FeatureStore)],x.prototype,"featureStore",2),C([(0,n.Inject)(n.SubscriptionHandler)],x.prototype,"subscriptionHandler",2),x=C([c.default],x);var S=Object.defineProperty,A=Object.getOwnPropertyDescriptor,P=(e,t,s,a)=>{for(var r,i=a>1?void 0:a?A(t,s):t,o=e.length-1;o>=0;o--)(r=e[o])&&(i=(a?r(t,s,i):r(i))||i);return a&&i&&S(t,s,i),i};let k=class extends r.default{getJourneyInstance(){return this.journey}mounted(){n.WebComponentBootstrapper.registerElementInstance(this,this.$el)}gotInstance(e){this.journey=e,this.journey.travelTo([o.BladeIds.default])}goBack(){o.Router.navigate(o.BladeIds.default,""),this.journey.travelBack()}goNext(e,t){this.targetResolverType==u.TargetResolverTypes.AppInstance?o.Router.navigate(o.BladeIds.properties,`${t}/`+e):o.Router.navigate(e,`${t}/`+e),this.journey.travelToNext(o.BladeIds.properties)}getFeatureHomeBlade(){return{id:o.BladeIds.default,size:u.BladeSizes.extramedium,content:()=>(0,a.h)(y,{attrs:{appInstanceId:this.appInstanceId,handleClose:this.onInstanceClosed,handleFeatureAction:this.goNext,targetResolverType:this.targetResolverType}})}}getFeaturePropertiesBlade(){return{id:o.BladeIds.properties,size:u.BladeSizes.medium,content:()=>(0,a.h)(x,{attrs:{handleClose:this.goBack,targetResolverType:this.targetResolverType}})}}render(){return(0,a.h)("omfx-journey",{domProps:{onInstanceCreated:this.gotInstance,onInstanceClosed:this.onInstanceClosed,blades:[this.getFeatureHomeBlade(),this.getFeaturePropertiesBlade()]}})}};P([(0,i.Prop)()],k.prototype,"appInstanceId",2),P([(0,i.Prop)()],k.prototype,"targetResolverType",2),P([(0,i.Prop)()],k.prototype,"onInstanceClosed",2),k=P([i.Component],k),n.WebComponentBootstrapper.registerElement((e=>{(0,n.vueCustomElement)(e.elementName,k)}))},"./node_modules/@vue/composition-api/dist/vue-composition-api.mjs":(e,t,s)=>{e.exports=s("dll-reference md2")("./node_modules/@vue/composition-api/dist/vue-composition-api.mjs")},"./node_modules/typestyle/umd/typestyle.js":(e,t,s)=>{e.exports=s("dll-reference md2")("./node_modules/typestyle/umd/typestyle.js")},"./node_modules/vue-class-component/dist/vue-class-component.esm.js":(e,t,s)=>{e.exports=s("dll-reference md2")("./node_modules/vue-class-component/dist/vue-class-component.esm.js")},"./node_modules/vue-property-decorator/lib/vue-property-decorator.js":(e,t,s)=>{e.exports=s("dll-reference md2")("./node_modules/vue-property-decorator/lib/vue-property-decorator.js")},"./node_modules/vue/dist/vue.esm.js":(e,t,s)=>{e.exports=s("dll-reference md2")("./node_modules/vue/dist/vue.esm.js")},"0111486e-5dc8-4705-8247-d91fb2aba33d":(e,t,s)=>{e.exports=s("dll-reference md66")("0111486e-5dc8-4705-8247-d91fb2aba33d")},"14a0ce2f-3699-49b2-92d3-428caac194a4":(e,t,s)=>{e.exports=s("dll-reference md66")("14a0ce2f-3699-49b2-92d3-428caac194a4")},"14a8d443-2e58-450b-a462-258bdaf69b49":(e,t,s)=>{e.exports=s("dll-reference md10")("14a8d443-2e58-450b-a462-258bdaf69b49")},"5326a8ef-4e3c-49d6-b415-1ddf7fdcc830":(e,t,s)=>{e.exports=s("dll-reference md8")("5326a8ef-4e3c-49d6-b415-1ddf7fdcc830")},"5e618f4d-d014-414e-a681-89e34cbeda0f":(e,t,s)=>{e.exports=s("dll-reference md10")("5e618f4d-d014-414e-a681-89e34cbeda0f")},"d0a145a7-d1ef-4217-aa6f-85dd18c4231d":(e,t,s)=>{e.exports=s("dll-reference md9")("d0a145a7-d1ef-4217-aa6f-85dd18c4231d")},"d7327742-5647-4075-b7ab-4f9ca852addb":(e,t,s)=>{e.exports=s("dll-reference md66")("d7327742-5647-4075-b7ab-4f9ca852addb")},"e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac":(e,t,s)=>{e.exports=s("dll-reference md10")("e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac")},"dll-reference md2":e=>{"use strict";e.exports=omniaVendor},"dll-reference md8":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["a1602121-3070-4304-b4d8-0859e50c482b"]},"dll-reference md9":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["a2892051-fd9f-4056-ae8d-30d16d48417d"]},"dll-reference md10":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["a5a89056-b5f5-475d-8518-a1f55090379d"]},"dll-reference md66":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["dee030cc-4ab3-4158-bb06-8049f5c67542"]}};if("undefined"==typeof omniaWebpackJsonp&&(globalThis.omniaWebpackJsonp={}),globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]=globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]||{},globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["fd300449-c17f-44fd-80d8-3e709a10bf63"])throw new Error("Error, already loaded manifest fd300449-c17f-44fd-80d8-3e709a10bf63 with service id bb000000-0000-bbbb-0000-0000000000bb");globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["fd300449-c17f-44fd-80d8-3e709a10bf63"]=s;var t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}s.d=(e,t)=>{for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};s("./client/fx/ux/features/featuresjourney.tsx")})()};