if("undefined"==typeof omniaLoader&&(globalThis.omniaLoader={}),omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]=omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]||{},omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["f2e8e9f7-e63f-401c-b5eb-bdcb07672372"])throw new Error("Error, already loaded manifest f2e8e9f7-e63f-401c-b5eb-bdcb07672372 with service id bb000000-0000-bbbb-0000-0000000000bb");omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["f2e8e9f7-e63f-401c-b5eb-bdcb07672372"]=function(){(()=>{var e={"./client/fx/workers/omniahubworker.js":(e,n,t)=>{"use strict";t.r(n);var a=t("46b8884f-20d6-40e6-b24e-54d8a6126ac9"),s=t("./client/fx/shared/broadcasting/internaltopics.js"),i=t("./node_modules/@microsoft/signalr/dist/webworker/signalr.js");class o{constructor(){this._activeChannels=new Map,this._channelIdsToActivate=new Map,this._channelIdsToDeactivate=new Map,this._pendingChannelUpdate=!1,globalThis.omnia.omniaHubMode&&this.setupRealtime().then((()=>{this.setupChannels(),this.setupMessageHandlers()}))}async setupRealtime(){const e={...omnia.tokenKey,tenantId:omnia.tenant.id},n=new a.Bring({baseUrl:"https://localhost:7100"}),t=(await n.post("/endpoints/token",e)).data,o=t["6567fa33-029d-47bf-a845-13be735104bb"];t["de5cec14-21e5-4fc5-8d78-3c1149760f65"];this._connection=(new i.HubConnectionBuilder).withUrl(`${o}/realtimehub`,{skipNegotiation:!0,transport:i.HttpTransportType.WebSockets,accessTokenFactory:()=>btoa(JSON.stringify(e))}).withAutomaticReconnect().build(),await this._connection.start().catch((e=>console.error(e))),console.dir(this._connection.connectionId),this._connection.onreconnected((e=>{console.dir(e),this._activeChannels.clear(),this._channelIdsToActivate.clear(),this._channelIdsToDeactivate.clear(),a.Broadcast.publish(s.realtimeTopics.getActiveChannels,null)}))}setupChannels(){a.Broadcast.subscribe(s.realtimeTopics.updateChannels,(e=>{e.forEach((e=>{let n=!1;const t=a.Guid.newGuid();if("activate"===e.type){const a=e.channelId.toLowerCase(),s=e.threadId;if(this._activeChannels.has(a)){const e=this._activeChannels.get(a);e.find((e=>e===s))||e.push(s)}else this._activeChannels.set(a,[s]),this._channelIdsToActivate.set(t,[a]),n=!0}else if("deactivate"===e.type&&this._activeChannels.has(e.channelId)){const a=this._activeChannels.get(e.channelId),s=a.indexOf(e.threadId);s>-1&&(a.splice(s,1),0===a.length&&(this._channelIdsToDeactivate.has(t)?this._channelIdsToDeactivate.get(t).push(e.channelId):this._channelIdsToDeactivate.set(t,[e.channelId]),this._activeChannels.delete(e.channelId),n=!0))}!this._pendingChannelUpdate&&n&&(this._pendingChannelUpdate=!0,setTimeout((()=>{this.syncChannelsWithBackend(t)}),500))}))})),a.Broadcast.publish(s.realtimeTopics.getActiveChannels,null)}setupMessageHandlers(){this._connection.on("ChannelMessage",((e,n,t)=>{a.Broadcast.publish(s.realtimeTopics.messageReceived,{channelId:e,dataId:n,data:t})})),a.Broadcast.subscribe(s.realtimeTopics.sendMessage,(e=>{this.sendMessageWithExponentialRetry("SendChannelMessage",e.channelId,e.dataId,e.data)}))}sendMessageWithExponentialRetry(e,n,t,a,s=0){s>5||this._connection.send(e,n,t,a).catch((i=>{console.error(i),setTimeout((()=>{this.sendMessageWithExponentialRetry(e,n,t,a,s+1)}),1e4)}))}async syncChannelsWithBackend(e){const n={channelIdsToActivate:this._channelIdsToActivate.get(e),channelIdsToDeactivate:this._channelIdsToDeactivate.get(e)};await this._connection.send("SyncChannels",n),this._pendingChannelUpdate=!1,this._channelIdsToActivate.delete(e),this._channelIdsToDeactivate.delete(e)}stringHashCode(e){let n=0;for(let t=0;t<e.length;++t)n=Math.imul(31,n)+e.charCodeAt(t);return 0|n}}a.Leader.awaitLeadership().then((()=>{new o}))},"./client/fx/shared/broadcasting/internaltopics.js":(e,n,t)=>{e.exports=t("dll-reference md18")("./client/fx/shared/broadcasting/internaltopics.js")},"./node_modules/@microsoft/signalr/dist/webworker/signalr.js":(e,n,t)=>{e.exports=t("dll-reference md3")("./node_modules/@microsoft/signalr/dist/webworker/signalr.js")},"46b8884f-20d6-40e6-b24e-54d8a6126ac9":(e,n,t)=>{e.exports=t("dll-reference md18")("46b8884f-20d6-40e6-b24e-54d8a6126ac9")},"dll-reference md18":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["6972ceca-544d-49c0-b575-67b1a5294812"]},"dll-reference md3":e=>{"use strict";e.exports=omniaWorkerVendor}};if("undefined"==typeof omniaWebpackJsonp&&(globalThis.omniaWebpackJsonp={}),globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]=globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]||{},globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["f2e8e9f7-e63f-401c-b5eb-bdcb07672372"])throw new Error("Error, already loaded manifest f2e8e9f7-e63f-401c-b5eb-bdcb07672372 with service id bb000000-0000-bbbb-0000-0000000000bb");globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["f2e8e9f7-e63f-401c-b5eb-bdcb07672372"]=t;var n={};function t(a){var s=n[a];if(void 0!==s)return s.exports;var i=n[a]={exports:{}};return e[a](i,i.exports,t),i.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};t("./client/fx/workers/omniahubworker.js")})()},omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["f2e8e9f7-e63f-401c-b5eb-bdcb07672372"]();