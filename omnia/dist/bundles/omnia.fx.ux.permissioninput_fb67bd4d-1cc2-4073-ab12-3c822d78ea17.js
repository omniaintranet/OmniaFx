if("undefined"==typeof omniaLoader&&(globalThis.omniaLoader={}),omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]=omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]||{},omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["fb67bd4d-1cc2-4073-ab12-3c822d78ea17"])throw new Error("Error, already loaded manifest fb67bd4d-1cc2-4073-ab12-3c822d78ea17 with service id bb000000-0000-bbbb-0000-0000000000bb");omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["fb67bd4d-1cc2-4073-ab12-3c822d78ea17"]=function(){(()=>{var e={"./client/fx/ux/permissioninput/permissioninput.tsx":(e,t,s)=>{"use strict";s.r(t),s.d(t,{PermissionInput:()=>f});var i,r=s("./node_modules/@vue/composition-api/dist/vue-composition-api.mjs"),o=s("./node_modules/vue-class-component/dist/vue-class-component.esm.js"),n=s("./node_modules/vue-property-decorator/lib/vue-property-decorator.js"),d=s("d7327742-5647-4075-b7ab-4f9ca852addb").setCurrentManifest("bb000000-0000-bbbb-0000-0000000000bb","fb67bd4d-1cc2-4073-ab12-3c822d78ea17"),a=s("14a8d443-2e58-450b-a462-258bdaf69b49").setCurrentManifest("bb000000-0000-bbbb-0000-0000000000bb","fb67bd4d-1cc2-4073-ab12-3c822d78ea17"),l=s("97786ea9-4861-48bd-8a57-eae9bbdb4892"),b=s("d0a145a7-d1ef-4217-aa6f-85dd18c4231d"),p=s("e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac");(i||(i={})).namespace="Omnia.Ux.PermissionInput";const c={error:(0,s("./node_modules/typestyle/umd/typestyle.js").style)({color:"red !important"})};var u=Object.defineProperty,m=Object.getOwnPropertyDescriptor,h=(e,t,s,i)=>{for(var r,o=i>1?void 0:i?m(t,s):t,n=e.length-1;n>=0;n--)(r=e[n])&&(o=(i?r(t,s,o):r(o))||o);return i&&o&&u(t,s,o),o};let f=class extends d.VueComponentBase{constructor(){super(...arguments),this.validator=null,this.isResolving=!1,this.errMsg="",this.isSaving=!1,this.result=null,this.previousPromiseRejecter=null}mounted(){a.WebComponentBootstrapper.registerElementInstance(this,this.$el),this.validator=new d.FormValidator(this)}beforeDestroy(){this.validator.clearValidation()}created(){this.getPermissionBindings(),this.subscriptionHandler.add(this.permissionService.onPermissionContextChanged.subscribe((()=>{this.getPermissionBindings()})))}getPermissionBindings(){if(this.errMsg="",this.result={},this.isResolving=!0,this.dataSource)this.setPermissionBindings(this.dataSource);else{let e=null;new Promise(((t,s)=>{this.previousPromiseRejecter&&this.previousPromiseRejecter(),this.previousPromiseRejecter=s,e=t})).then(this.setPermissionBindings).catch((()=>{}));const t=this.settings.roles.map((e=>e.id.toLowerCase()));this.permissionService.getPermissionBindings(t,this.contextParams).then(e)}}setPermissionBindings(e){this.errMsg="",this.result={},Object.keys(e).forEach((t=>{this.result[t]=this.mapToUserIdentities(e[t])})),this.isResolving=!1}mapToUserIdentities(e){let t=[];for(const s of e)t=[...t,...this.getPermissionIdentities(s)];return t.map((e=>l.Utils.getIdentityId(e)))}mapToRolePermissionSetting(e,t){const s={roleId:e,identities:[],groups:[],userDefinedRules:[]};for(const e of t)b.Constants.security.userDefinedSupportedRoles.indexOf(e.uid)>=0?s.userDefinedRules.push({roleId:e.uid}):l.Utils.isOnPrem(this.omniaCtx.environment.backendRuntime)?-1!==e.uid.indexOf(b.IdentityUserIdTypeMatch.SPOnpremAdGroup)?s.groups.push(e.uid):-1!==e.uid.indexOf(b.IdentityUserIdTypeMatch.SPOnpremAdUser)&&s.identities.push(e.uid):-1==e.uid.indexOf("@")?s.groups.push(e.uid):s.identities.push(e.uid);return s}getPermissionIdentities(e){if(e.identity==b.SecurityIdentities.OverridenRulesBindingIdentity){const t=[];if(e.userDefinedRules&&e.userDefinedRules.length>0)for(const s of e.userDefinedRules){if("AND"==s.logicalOperator)return[];s.roleId==b.RoleDefinitions.AuthorizedUsers?l.Utils.isOnPrem(this.omniaCtx.environment.backendRuntime)?t.indexOf(b.RoleDefinitions.InternalUsers)<0&&t.push(b.RoleDefinitions.InternalUsers):(t.indexOf(b.RoleDefinitions.InternalUsersExceptRestricted)<0&&t.push(b.RoleDefinitions.InternalUsersExceptRestricted),t.indexOf(b.RoleDefinitions.ExternalUsers)<0&&t.push(b.RoleDefinitions.ExternalUsers)):t.indexOf(s.roleId)<0&&t.push(s.roleId)}return t}return[e.identity]}onPeoplePickerModelChange(e,t){if(this.result[e]=t,this.hideSaveButton){const e=[];Object.keys(this.result).forEach((t=>{e.push(this.mapToRolePermissionSetting(t,this.result[t]))})),null!=this.onValueUpdated&&this.onValueUpdated(e)}this.$forceUpdate()}save(){(null!==this.onValueUpdating&&void 0!==this.onValueUpdating?this.onValueUpdating():Promise.resolve()).then((()=>{if(!this.isSaving&&this.validator.validateAll()){this.isSaving=!0,this.errMsg="";const e=[];Object.keys(this.result).forEach((t=>{e.push(this.mapToRolePermissionSetting(t,this.result[t]))}));const t={permissionSettings:e};this.permissionService.addOrUpdatePermissionBindings(t,this.contextParams,this.serviceId).then((()=>{null!=this.onValueUpdated?this.onValueUpdated(e).then((()=>{this.isSaving=!1})).catch((e=>{this.isSaving=!1,this.errMsg=e})):this.isSaving=!1})).catch((e=>{this.isSaving=!1,this.errMsg=e}))}}))}renderButtonsAndMsg(){const e=Object.keys(this.result).length>0;if(!this.hideSaveButton&&e){let e=!1;return Object.keys(this.result).indexOf(p.SecurityRoles.Tenant.Admin)>=0&&0==this.result[p.SecurityRoles.Tenant.Admin].length&&(e=!0),(0,r.h)("div",[this.errMsg?(0,r.h)("v-card-text",{attrs:{dark:this.dark},class:c.error},[this.errMsg]):null,(0,r.h)("div",{class:"text-right"},[(0,r.h)("omfx-button",{attrs:{dark:this.dark,disabled:this.disabled||e,loading:this.isSaving,text:this.omniaUxLoc.Common.Buttons.Save},domProps:{mode:b.ButtonModes.flat,onClick:()=>{this.save()}}})])])}return null}renderPermissionInput(){return this.settings.roles.map((e=>{const t=e.id.toLowerCase(),s=this.result[t],i=e.id==p.SecurityRoles.Tenant.Admin;return!s&&this.isResolving?(0,r.h)("v-text-field",{attrs:{dark:this.dark,label:e.label,loading:this.isResolving,disabled:!0}}):s||this.isResolving?(0,r.h)("omfx-people-picker",{attrs:{dark:this.dark,required:i,showSpecialIdentities:e.showSpecialIdentities,multiple:!0,disabled:this.disabled||this.isSaving,label:e.label},domProps:{useValidator:this.validator,principalType:e.principalType,valueBind:s,onValueChanged:e=>{this.onPeoplePickerModelChange(t,e)}}}):(0,r.h)("v-text-field",{attrs:{dark:this.dark,label:e.label,placeholder:this.loc.PermissionMsg,disabled:!0}})}))}render(){return(0,r.h)("div",[this.result?[this.renderPermissionInput(),this.renderButtonsAndMsg()]:(0,r.h)("div",{class:"text-center"},[(0,r.h)("v-progress-circular",{attrs:{indeterminate:!0}})])])}};h([(0,a.Inject)(a.SubscriptionHandler)],f.prototype,"subscriptionHandler",2),h([(0,a.Inject)(p.PermissionService)],f.prototype,"permissionService",2),h([(0,a.Inject)(a.OmniaContext)],f.prototype,"omniaCtx",2),h([(0,a.Localize)(i.namespace)],f.prototype,"loc",2),h([(0,a.Localize)(d.OmniaUxLocalizationNamespace)],f.prototype,"omniaUxLoc",2),h([(0,n.Prop)()],f.prototype,"settings",2),h([(0,n.Prop)()],f.prototype,"contextParams",2),h([(0,n.Prop)()],f.prototype,"onValueUpdated",2),h([(0,n.Prop)()],f.prototype,"onValueUpdating",2),h([(0,n.Prop)({default:!1})],f.prototype,"dark",2),h([(0,n.Prop)({default:!1})],f.prototype,"hideSaveButton",2),h([(0,n.Prop)({default:!1})],f.prototype,"disabled",2),h([(0,n.Prop)()],f.prototype,"serviceId",2),h([(0,n.Prop)()],f.prototype,"dataSource",2),f=h([o.default],f),a.WebComponentBootstrapper.registerElement((e=>{(0,a.vueCustomElement)(e.elementName,f)}))},"./node_modules/@vue/composition-api/dist/vue-composition-api.mjs":(e,t,s)=>{e.exports=s("dll-reference md2")("./node_modules/@vue/composition-api/dist/vue-composition-api.mjs")},"./node_modules/typestyle/umd/typestyle.js":(e,t,s)=>{e.exports=s("dll-reference md2")("./node_modules/typestyle/umd/typestyle.js")},"./node_modules/vue-class-component/dist/vue-class-component.esm.js":(e,t,s)=>{e.exports=s("dll-reference md2")("./node_modules/vue-class-component/dist/vue-class-component.esm.js")},"./node_modules/vue-property-decorator/lib/vue-property-decorator.js":(e,t,s)=>{e.exports=s("dll-reference md2")("./node_modules/vue-property-decorator/lib/vue-property-decorator.js")},"14a8d443-2e58-450b-a462-258bdaf69b49":(e,t,s)=>{e.exports=s("dll-reference md10")("14a8d443-2e58-450b-a462-258bdaf69b49")},"97786ea9-4861-48bd-8a57-eae9bbdb4892":(e,t,s)=>{e.exports=s("dll-reference md9")("97786ea9-4861-48bd-8a57-eae9bbdb4892")},"d0a145a7-d1ef-4217-aa6f-85dd18c4231d":(e,t,s)=>{e.exports=s("dll-reference md9")("d0a145a7-d1ef-4217-aa6f-85dd18c4231d")},"d7327742-5647-4075-b7ab-4f9ca852addb":(e,t,s)=>{e.exports=s("dll-reference md66")("d7327742-5647-4075-b7ab-4f9ca852addb")},"e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac":(e,t,s)=>{e.exports=s("dll-reference md10")("e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac")},"dll-reference md2":e=>{"use strict";e.exports=omniaVendor},"dll-reference md9":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["a2892051-fd9f-4056-ae8d-30d16d48417d"]},"dll-reference md10":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["a5a89056-b5f5-475d-8518-a1f55090379d"]},"dll-reference md66":e=>{"use strict";e.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["dee030cc-4ab3-4158-bb06-8049f5c67542"]}};if("undefined"==typeof omniaWebpackJsonp&&(globalThis.omniaWebpackJsonp={}),globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]=globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]||{},globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["fb67bd4d-1cc2-4073-ab12-3c822d78ea17"])throw new Error("Error, already loaded manifest fb67bd4d-1cc2-4073-ab12-3c822d78ea17 with service id bb000000-0000-bbbb-0000-0000000000bb");globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["fb67bd4d-1cc2-4073-ab12-3c822d78ea17"]=s;var t={};function s(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,s),o.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};s("./client/fx/ux/permissioninput/permissioninput.tsx")})()};