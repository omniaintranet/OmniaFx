if("undefined"==typeof omniaLoader&&(globalThis.omniaLoader={}),omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]=omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]||{},omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["ffa71f76-ab46-494a-9180-e1f55885ce4d"])throw new Error("Error, already loaded manifest ffa71f76-ab46-494a-9180-e1f55885ce4d with service id bb000000-0000-bbbb-0000-0000000000bb");omniaLoader["bb000000-0000-bbbb-0000-0000000000bb"]["ffa71f76-ab46-494a-9180-e1f55885ce4d"]=function(){(()=>{var t={"./client/fx/ux/post/post.tsx":(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>f});var o=s("./node_modules/typestyle/umd/typestyle.js"),i=s("./node_modules/vue-class-component/dist/vue-class-component.esm.js"),r=s("./node_modules/vue-property-decorator/lib/vue-property-decorator.js"),n=s("./node_modules/@vue/composition-api/dist/vue-composition-api.mjs"),d=s("d7327742-5647-4075-b7ab-4f9ca852addb").setCurrentManifest("bb000000-0000-bbbb-0000-0000000000bb","ffa71f76-ab46-494a-9180-e1f55885ce4d"),p=s("14a8d443-2e58-450b-a462-258bdaf69b49").setCurrentManifest("bb000000-0000-bbbb-0000-0000000000bb","ffa71f76-ab46-494a-9180-e1f55885ce4d"),a=s("5326a8ef-4e3c-49d6-b415-1ddf7fdcc830"),l=s("e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac"),h=s("./client/fx/ux/models/index.js"),c=s("./client/fx/ux/styleflow.js"),b=s("./client/fx/ux/post/loc/localize.js"),g=s("./node_modules/csx/lib.es2015/index.js");c.StyleFlow.define(h.PostStyle,{postCountWrapper:t=>({textAlign:"end",fontSize:"14px",fontWeight:400,color:t.body.bg.dark?t.body.bg.color.lighten5:t.body.bg.color.darken4}),slimSpacing:{marginBottom:"1px"},postWrapper:{minHeight:"50px",position:"relative",$nest:{"&:last-child":{borderLeft:"none"}}},postWrapperDialog:{display:"none"},replyWrapper:{paddingLeft:"78px"},topPostAvatarWrapper:{position:(0,g.important)("absolute"),borderRadius:"50%",left:"0px",background:"transparent"},replyAvatarWrapper:{height:"36px",width:"36px",position:"absolute",borderRadius:"50%",left:"38px",background:"transparent"},connectLine:{position:"absolute",height:"1px",width:"24px",background:"#d6d6d6",top:"24px",left:0},showMoreActionWrapper:t=>({fontSize:"14px",fontWeight:450,color:(0,g.important)(t.body.bg.dark?t.body.bg.color.lighten5:t.body.bg.color.darken4)}),showMoreExtraSpacing:{marginLeft:"50px"},showMoreExtraSpacingReply:{marginLeft:"72px"}});var u=Object.defineProperty,m=Object.getOwnPropertyDescriptor,y=(t,e,s,o)=>{for(var i,r=o>1?void 0:o?m(e,s):e,n=t.length-1;n>=0;n--)(i=t[n])&&(r=(o?i(e,s,r):i(r))||r);return o&&r&&u(e,s,r),r};let f=class extends d.VueComponentBase{constructor(){super(...arguments),this.isLoading=!0,this.currentUser=null,this.showOnlyPromotedPost=!1,this.canCreateNewPost=!1,this.postAddingHashKey="",this.postsReplyingHashKey={},this.postsHashKey={},this.postAdding=null,this.postsReplying={},this.postsBeingEdited=[],this.currentShowMoreSize={},this.postClasses=c.StyleFlow.use(h.PostStyle),this.minIndexToShow=0,this.topMostId=p.Utils.generateGuid().toString(),this.topPosts=[],this.postTemplate="omfx-post-template",this.handlePostAdding=(t,e,s=null)=>{s?(t&&!e?this.extendCurrentShowMoreSize(s.postId?.toString(),1):e&&(this.postsHashKey[e]=p.Utils.generateGuid()),this.postsReplying={}):(this.initPostAdding(),this.extendCurrentShowMoreSize(this.topMostId,1),e&&(this.postsHashKey[e]=p.Utils.generateGuid()))}}onPromotedPostChange(t,e){t?.postId?.toString()!==e?.postId?.toString()&&(this.showOnlyPromotedPost=!p.Utils.isNullOrEmpty(this.provider.promotedPost))}onPostsChange(t,e){const s=this.currentShowMoreSize[this.topMostId]||this.showMoreSize;this.topPosts=this.provider.posts.filter((t=>!this.getTopPostIds()[t.postId?.toString()])),this.minIndexToShow=this.topPosts.length-s,this.updateCreatePostPermission()}created(){this.postClasses=c.StyleFlow.use(h.PostStyle,this.styles),this.userService.getCurrentUser().then((t=>{this.currentUser=t,this.initPostAdding()})),this.showOnlyPromotedPost=!p.Utils.isNullOrEmpty(this.provider.promotedPost)}mounted(){const t=this.currentShowMoreSize[this.topMostId]||this.showMoreSize;this.topPosts=this.provider.posts.filter((t=>!this.getTopPostIds()[t.postId?.toString()])),this.minIndexToShow=this.topPosts.length-t,this.updateCreatePostPermission(),p.WebComponentBootstrapper.registerElementInstance(this,this.$el)}updateCreatePostPermission(){for(const t of Object.keys(this.topicPermissionDictionary))if(this.topicPermissionDictionary[t].contributor)return void(this.canCreateNewPost=!0);this.canCreateNewPost=!1}initPostAdding(){const t={content:"",parentId:null,context:{getTopicId:()=>null,omniaServiceId:this.omniaServiceId},mentionedUsers:[],postTypeId:this.postTypeId};this.postAdding={likedBy:[],post:t,omniaServiceId:null,postTypeId:null,postId:null,createdBy:this.currentUser}}extendCurrentShowMoreSize(t,e){let s=this.currentShowMoreSize[t]||this.showMoreSize;e?s+=e:(s+=this.showMoreSize,this.topPosts=this.provider.posts.filter((t=>!this.getTopPostIds()[t.postId?.toString()])),this.minIndexToShow=this.topPosts.length-s),this.currentShowMoreSize[t]=s,this.$forceUpdate()}onCancelReply(t){const e=this.getTopPostIds()[t.post.parentId?.toString()]||t.postId.toString();this.postsReplying[e.toString()]=null,this.$forceUpdate()}onOpenReply(t){this.showOnlyPromotedPost=!1;const e=this.getTopPostIds()[t.post.parentId?.toString()]||t.postId.toString();if(this.postsReplyingHashKey[e.toString()]=p.Utils.generateGuid(),t.deletedBy)delete this.postsReplying[e.toString()];else{const s={content:"",parentId:t.postId,context:t.post.context,mentionedUsers:[],postTypeId:this.postTypeId};this.postsReplying[e.toString()]={likedBy:[],post:s,omniaServiceId:null,postTypeId:null,postId:null,createdBy:this.currentUser,createdAt:null},setTimeout((()=>{const t=Zepto(`#${this.postsReplyingHashKey[e.toString()]}`)[0];t&&!this.isElementInViewport(t)&&t.scrollIntoView&&p.Utils.isFunction(t.scrollIntoView)&&t.scrollIntoView(!1)}),100)}this.$forceUpdate()}openEditPost(t){-1===this.postsBeingEdited.indexOf(t)&&(this.postsBeingEdited.push(t),this.provider.handler.handleEditingPosts&&this.provider.handler.handleEditingPosts(this.postsBeingEdited))}cancelEditPost(t){if(-1!==this.postsBeingEdited.indexOf(t)){const e=this.postsBeingEdited.indexOf(t);this.postsBeingEdited.splice(e),this.provider.handler.handleEditingPosts&&this.provider.handler.handleEditingPosts(this.postsBeingEdited)}}isElementInViewport(t){const e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}getPostsCountLabel(t){switch(t){case 0:case 1:return this.postLoc.PostsCountLabel.LessThenTwoPosts;default:return this.postLoc.PostsCountLabel.TwoOrMorePosts}}renderPosts(){const t=this.provider.posts.filter((t=>!t.deletedBy)).length,e=this.getPostsCountLabel(t),s=this.currentShowMoreSize[this.topMostId]||this.showMoreSize;return(0,n.h)("div",[(this.canCreateNewPost||t>0)&&(0,n.h)("div",{class:(0,o.classes)("pb-1",this.theming.body.text.css,this.postClasses.postCountWrapper(this.theming))},[t," ",e]),(0,n.h)("div",[this.canCreateNewPost&&this.renderMainPostComponent(this.postAdding,!0)]),this.topPosts.map(((t,e)=>e>=s?null:[this.renderMainPostComponent(t,!1),this.renderPostsWithReplies(t)])),s<this.topPosts.length&&this.renderShowMoreOption(this.topMostId)])}renderShowMoreOption(t){return(0,n.h)("div",{class:t===this.topMostId?(0,o.classes)("pb-4",this.postClasses.showMoreExtraSpacing):(0,o.classes)("pl-4 pb-3",this.postClasses.showMoreExtraSpacingReply)},[(0,n.h)("a",{class:[this.theming.body.text.css,this.postClasses.showMoreActionWrapper(this.theming)],attrs:{tabindex:0},on:{click:()=>{this.extendCurrentShowMoreSize(t)}}},[this.postLoc.ViewMorePosts])])}renderShowAllOption(t){return(0,n.h)("div",{class:t===this.topMostId?"":(0,o.classes)("ps-4","ms-6")},[(0,n.h)("a",{class:[this.theming.body.text.css,this.postClasses.showMoreActionWrapper(this.theming)],attrs:{tabindex:0},on:{click:()=>{this.showOnlyPromotedPost=!1}}},[this.postLoc.ViewAllPosts])])}renderMainPostComponent(t,e){const s=t.postId;return(0,n.h)("div",{class:(0,o.classes)(this.postClasses.postWrapper,e?this.postClasses.slimSpacing:"pb-2","pl-10")},[this.getUserHash()[t.createdBy.uid.toLowerCase()]?(0,n.h)("v-img",{class:(0,o.classes)(this.postClasses.topPostAvatarWrapper),attrs:{width:"36px",height:"36px",src:this.getUserHash()[t.createdBy.uid.toLowerCase()].avatar}}):(0,n.h)("v-icon",{class:(0,o.classes)(this.postClasses.topPostAvatarWrapper)},["fa-question"]),(0,n.h)(this.postTemplate,{domProps:{canLike:this.allowLikes,enableMention:this.enableMention,canShowEditDialogOnLoad:!1,cancelReply:this.onCancelReply,persistedPost:t,persistedPosts:this.provider.posts,currentUser:this.currentUser,openReply:this.onOpenReply,refresh:t=>{this.handlePostAdding(t,s?.toString())},cardStyle:this.cardStyle,richTextSettings:this.richTextSettings,handleAddingPost:this.provider.handler.handleAddingPost,handleUpdatingPost:this.provider.handler.handleUpdatingPost,handleDeletingPost:this.provider.handler.handleDeletingPost,handleTogglingLike:this.provider.handler.handleTogglingLike,customSlots:this.customSlots,hideEditOption:this.hideEditOption,openEdit:this.openEditPost,closeEdit:this.cancelEditPost,getTopPostIds:this.getTopPostIds,getUserHash:this.getUserHash,topicPermissionDictionary:this.topicPermissionDictionary}})])}renderPostsWithReplies(t){let e=[];const s=this.postsReplying[t.postId?.toString()],i=this.provider.posts.filter((e=>this.getTopPostIds()[e.postId?.toString()]===t.postId));i&&(e=i);const r=this.currentShowMoreSize[t.postId?.toString()]||this.showMoreSize;return s&&!s.postId&&""===s.post.content&&e.unshift(s),(0,n.h)("div",[e.map(((e,s)=>{const i=window.outerWidth<=500&&p.Utils.isNullOrEmpty(e.post.content);if(s>=r)return;const d=e.postId?.toString(),a=d?this.postsHashKey[d]||d:this.postsReplyingHashKey[t.postId?.toString()];return(0,n.h)("div",[(0,n.h)("div",{class:[(0,o.classes)(this.postClasses.postWrapper,"pb-2"),this.postClasses.replyWrapper,i?this.postClasses.postWrapperDialog:null]},[this.getUserHash()[e.createdBy.uid.toLowerCase()]?(0,n.h)("img",{class:(0,o.classes)(this.postClasses.replyAvatarWrapper),attrs:{src:this.getUserHash()[e.createdBy.uid.toLowerCase()].avatar}}):(0,n.h)("v-icon",{class:(0,o.classes)(this.postClasses.replyAvatarWrapper)},["fa-question"]),(0,n.h)(this.postTemplate,{domProps:{canLike:this.allowLikes,enableMention:this.enableMention,canShowEditDialogOnLoad:!0,cancelReply:this.onCancelReply,persistedPost:e,persistedPosts:this.provider.posts,currentUser:this.currentUser,openReply:this.onOpenReply,refresh:e=>{this.handlePostAdding(e,d,t)},cardStyle:this.cardStyle,richTextSettings:this.richTextSettings,handleAddingPost:this.provider.handler.handleAddingPost,handleUpdatingPost:this.provider.handler.handleUpdatingPost,handleDeletingPost:this.provider.handler.handleDeletingPost,handleTogglingLike:this.provider.handler.handleTogglingLike,customSlots:this.customSlots,hideEditOption:this.hideEditOption,openEdit:this.openEditPost,closeEdit:this.cancelEditPost,getTopPostIds:this.getTopPostIds,getUserHash:this.getUserHash,topicPermissionDictionary:this.topicPermissionDictionary},attrs:{id:a}})]),(0,n.h)("div",[this.renderPostsWithReplies(e)])])})),r<e.length&&this.renderShowMoreOption(t.postId?.toString())])}renderPromotedPost(){if(this.provider.posts){if(this.provider.promotedPost){const t=[],e=this.provider.posts.filter((t=>!t.deletedBy)).length,s=this.getPostsCountLabel(e);return t.push((0,n.h)("div",{class:(0,o.classes)("pb-1",this.theming.body.text.css)})),t.push((0,n.h)("v-row",{attrs:{"no-gutter":!0}},[(0,n.h)("v-col",{attrs:{cols:"6"},class:"pt-1"},[this.renderShowAllOption(this.topMostId)]),(0,n.h)("v-col",{attrs:{cols:"6"},class:[this.theming.body.text.css,this.postClasses.postCountWrapper,"pt-1"]},[e," ",s])])),t.push(this.renderMainPostComponent(this.provider.promotedPost,!1)),t}return this.renderPosts()}}render(){return this.currentUser&&(0,n.h)("div",[" ",this.showOnlyPromotedPost?this.renderPromotedPost():this.renderPosts()," "])}};y([(0,p.Inject)(l.UserService)],f.prototype,"userService",2),y([(0,p.Inject)(a.OmniaContext)],f.prototype,"omniaContext",2),y([(0,p.Localize)(b.PostLocalization.namespace)],f.prototype,"postLoc",2),y([(0,r.Prop)()],f.prototype,"provider",2),y([(0,r.Prop)()],f.prototype,"editContentOnTop",2),y([(0,r.Prop)()],f.prototype,"omniaServiceId",2),y([(0,r.Prop)()],f.prototype,"postTypeId",2),y([(0,r.Prop)({default:2})],f.prototype,"showMoreSize",2),y([(0,r.Prop)()],f.prototype,"richTextSettings",2),y([(0,r.Prop)()],f.prototype,"styles",2),y([(0,r.Prop)()],f.prototype,"cardStyle",2),y([(0,r.Prop)({default:!0})],f.prototype,"allowLikes",2),y([(0,r.Prop)({default:!1})],f.prototype,"enableMention",2),y([(0,r.Prop)()],f.prototype,"customSlots",2),y([(0,r.Prop)({default:!1})],f.prototype,"hideEditOption",2),y([(0,r.Prop)()],f.prototype,"getTopPostIds",2),y([(0,r.Prop)()],f.prototype,"getUserHash",2),y([(0,r.Prop)()],f.prototype,"topicPermissionDictionary",2),y([(0,r.Watch)("provider.promotedPost",{immediate:!1,deep:!0})],f.prototype,"onPromotedPostChange",1),y([(0,r.Watch)("provider.posts",{immediate:!1,deep:!0})],f.prototype,"onPostsChange",1),f=y([i.default],f),p.WebComponentBootstrapper.registerElement((t=>{(0,p.vueCustomElement)(t.elementName,f,{destroyTimeout:1e3})}))},"./client/fx/ux/models/index.js":(t,e,s)=>{t.exports=s("dll-reference md66")("./client/fx/ux/models/index.js")},"./client/fx/ux/post/loc/localize.js":(t,e,s)=>{t.exports=s("dll-reference md66")("./client/fx/ux/post/loc/localize.js")},"./client/fx/ux/styleflow.js":(t,e,s)=>{t.exports=s("dll-reference md66")("./client/fx/ux/styleflow.js")},"./node_modules/@vue/composition-api/dist/vue-composition-api.mjs":(t,e,s)=>{t.exports=s("dll-reference md2")("./node_modules/@vue/composition-api/dist/vue-composition-api.mjs")},"./node_modules/csx/lib.es2015/index.js":(t,e,s)=>{t.exports=s("dll-reference md2")("./node_modules/csx/lib.es2015/index.js")},"./node_modules/typestyle/umd/typestyle.js":(t,e,s)=>{t.exports=s("dll-reference md2")("./node_modules/typestyle/umd/typestyle.js")},"./node_modules/vue-class-component/dist/vue-class-component.esm.js":(t,e,s)=>{t.exports=s("dll-reference md2")("./node_modules/vue-class-component/dist/vue-class-component.esm.js")},"./node_modules/vue-property-decorator/lib/vue-property-decorator.js":(t,e,s)=>{t.exports=s("dll-reference md2")("./node_modules/vue-property-decorator/lib/vue-property-decorator.js")},"14a8d443-2e58-450b-a462-258bdaf69b49":(t,e,s)=>{t.exports=s("dll-reference md10")("14a8d443-2e58-450b-a462-258bdaf69b49")},"5326a8ef-4e3c-49d6-b415-1ddf7fdcc830":(t,e,s)=>{t.exports=s("dll-reference md8")("5326a8ef-4e3c-49d6-b415-1ddf7fdcc830")},"d7327742-5647-4075-b7ab-4f9ca852addb":(t,e,s)=>{t.exports=s("dll-reference md66")("d7327742-5647-4075-b7ab-4f9ca852addb")},"e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac":(t,e,s)=>{t.exports=s("dll-reference md10")("e25b9dd8-6dd7-4437-8ddd-0b9fadba73ac")},"dll-reference md2":t=>{"use strict";t.exports=omniaVendor},"dll-reference md8":t=>{"use strict";t.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["a1602121-3070-4304-b4d8-0859e50c482b"]},"dll-reference md10":t=>{"use strict";t.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["a5a89056-b5f5-475d-8518-a1f55090379d"]},"dll-reference md66":t=>{"use strict";t.exports=omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["dee030cc-4ab3-4158-bb06-8049f5c67542"]}};if("undefined"==typeof omniaWebpackJsonp&&(globalThis.omniaWebpackJsonp={}),globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]=globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]||{},globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["ffa71f76-ab46-494a-9180-e1f55885ce4d"])throw new Error("Error, already loaded manifest ffa71f76-ab46-494a-9180-e1f55885ce4d with service id bb000000-0000-bbbb-0000-0000000000bb");globalThis.omniaWebpackJsonp["bb000000-0000-bbbb-0000-0000000000bb"]["ffa71f76-ab46-494a-9180-e1f55885ce4d"]=s;var e={};function s(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,s),r.exports}s.d=(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};s("./client/fx/ux/post/post.tsx")})()};